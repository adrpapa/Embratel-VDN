<!DOCTYPE html>
<html>
<head>
	<script src="/aps/2/ui/runtime/client/aps/aps.js"></script>
	<script>
		require([
                  "aps/ResourceStore",
                "dijit/registry",
                 "dojo/when",
            "dojox/mvc/getPlainValue",
            "dojox/mvc/at",
            "dojox/mvc/getStateful",
                  "aps/load",
                  "aps/PageContainer",
                  "aps/Memory",
                 "./js/displayError.js",
                  "aps/ready!"
        ], function (Store, registry, when, getPlainValue, at, getStateful, load, PageContainer, Memory, displayError) {
            var store = new Store({
                    target: "/aps/2/resources"
                }),
                model;

            /* Getting Job properties */
            store.get(aps.context.vars.content.aps.id).then(function(object){
                /* Collect the Job properties in the model */
                model = getStateful(object);
                var totalSec = Math.round(model["content_time_length"]/1000);
                var minutes = "000" + Math.round( totalSec / 60 );
                var seconds = "0" + totalSec % 60;
                var tempo = minutes.substr(minutes.length -3);
                tempo += ":" + seconds.substr(seconds.length -2);
                var proto = model["https"] ? "https" : "http";
                /* and create the widgets */
                var basename = proto+"://"+model["cdn_routing_uri"];
                var clientUri = [["aps/Output", { id: "hlsEndpoint",label: _("HLS"),value: basename + ".m3u8" }]];
                if( model["premium"] ){
                    clientUri.push( ["aps/Output", { id: "hdsEndpoint",label: _("HDS"),value: basename + ".f4m" }] );
                    clientUri.push( ["aps/Output", { id: "mssEndpoint",label: _("MSS"),value: basename + ".ism/Manifest" }] );
                    clientUri.push( ["aps/Output", { id: "dashEndpoint",label: _("DASH"),value: basename + ".mpd" }] );
                }
                var widgets =
                    ["aps/PageContainer", { id: "page" }, [
                        ["aps/FieldSet", { id: "title", title:  _("Content Information")  }, [
                            ["aps/Output", {
                                content: _("File Name: ${fn}"),
                                fn: at(model, "content_name")
                            }],
                            ["aps/Output", {
                                id: "screen_format",
                                label: _("Screen Format: ${sf}"),
                                sf: at(model, "screen_format")}
                            ],
                            ["aps/Output", {
                                content: _("Duration ${duration}"),
                                duration: tempo }],
                            ["aps/Output", {
                                content: _("Input URL: ${url}"),
                                url: at(model, "input_URI")}]
                        ]],
                        ["aps/FieldSet", { id: "endpoints", title: _("Public Endpoints") }, clientUri]
                ]];
                return load(widgets);
            }).then(function(){
                /* Once the widgets are created, create handlers for the navigation buttons */
                aps.app.onCancel = function() {
                        aps.apsc.gotoView("contents");
                    };
                }).otherwise(displayError);
            } // End-Function
        ); // End-Require
    </script>
</head>
<body>
</body>
</html>
