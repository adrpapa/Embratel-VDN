<!DOCTYPE html>
<html>
<head>
    <script src="/aps/2/ui/runtime/client/aps/aps.js"></script>
    <script>
        require([       "aps/ResourceStore",
                       "dojo/when",
                      "dijit/registry",
                        "aps/load",
                        "aps/Memory",
                  "dojox/mvc/getStateful",
                  "dojox/mvc/getPlainValue",
                        "aps/WizardData",
                        "dojox/mvc/at",
                       "./js/displayError.js",
                        "aps/ready!"],
			function (Store, when, registry, load, Memory, getStateful, getPlainValue, wd, at,
				displayError)
			{
				"use strict";
				
				var store = new Store({
					apsType: "http://embratel.com.br/app/VDN_Embratel/cdn/2.0",
					//target: "/aps/2/resources/" + aps.context.vars.context.aps.id + "/jobs"
					target: "/aps/2/resources/"
					}),
					model = getStateful(wd.get());

				/* Create widgets */
				var widget =
					["aps/PageContainer", { id: "page" }, [
						["aps/FieldSet", { id: "new1_general", title: true }, [
							["aps/TextBox", { id: "new_cdnName", label: _("Name"), value: at(model, "name"), required: true }],
							["aps/TextBox", { id: "new_description", label: _("Description"), value: at(model, "description") }],
							["aps/TextBox", { id: "new_alias", label: _("Alias"), value: at(model, "alias") }],
							["aps/TextBox", { id: "new_origin_server", label: _("Origin Server"), value: at(model, "origin_server") }],
							["aps/TextBox", { id: "new_origin_path",   label: _("Origin Path"), value: at(model, "origin_path") }]
						]],
						["aps/FieldSet", { id: "new1_props", title: true}, [
							["aps/CheckBox", { id: "new_https", label: _("Use HTTPS?"), checked: at(model, "https") } ],
							["aps/CheckBox", { id: "new_live", label: _("Live?"), checked: at(model, "live") } ]
						]]
				]];
				
				load(widget).then(function()
				{
					/* Create handlers for the navigation buttons */
					aps.app.onSubmit = function()
					{
						var page = registry.byId("page");
						if (!page.validate()) {
							aps.apsc.cancelProcessing();
							return;
						}
						when(store.put(getPlainValue(model)),
							function(){ aps.apsc.gotoView("cdns"); },
							displayError
						);
					};
					aps.app.onPrev = function()
					{
// 	                	aps.apsc.prev();
						aps.apsc.gotoView("cdn-new-1");
					};
				});
			} // End of function
		); // End of require
	</script>
</head>
<body>
</body>
</html>
