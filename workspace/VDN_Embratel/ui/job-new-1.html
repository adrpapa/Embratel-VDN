<!DOCTYPE html>
<html>
<head>
    <script src="/aps/2/ui/runtime/client/aps/aps.js"></script>
    <script>
        require([
                "dijit/registry",
            "dojox/mvc/getPlainValue",
                  "aps/WizardData",
            "dojox/mvc/at",
                  "aps/load",
                  "aps/Memory",
            "dojox/mvc/getStateful",
                  "aps/ready!"
        ], function (registry, getPlainValue, wd, at, load, Memory, getStateful) {
            var job_new = {
                aps: { type: "http://embratel.com.br/app/VDN_Embratel/job/2.0" },
                name: "",
                description: "",
                input_URI: "",
                screen_format: "16:9",
                https: false,
                premium: false,
                resolutions : [],
                framerates : [],
                video_bitrates : [],
                audio_bitrates : []
            };
            /* Declare the data source */
            var model = typeof aps.context.params.isNew === "undefined"? job_new: getStateful(wd.get());
            
            var screen_formats = new Memory({
                idProperty: "value",
                    data: [{ value:"16:9",		label: "16:9 (Widescreen)" },
                           { value: "4:3",		label: "4:3" }]
            });
            var useAuth = false;
            /* Create widgets */
            var widgets =
                ["aps/PageContainer", { id: "page" }, [
                    ["aps/FieldSet", { id: "new_general", title:  _("General Configuration")  }, [
//                         ["aps/TextBox", { id: "new_jobName", label: _("Content Name"), value: at(model, "name"), required: true }],
                        ["aps/TextBox", {
                            id: "new_input_uri",
                            label: _("Input URI"),
                            value: at(model, "input_URI"),
                            promptMessage: _('URI of content to be processed. Supported Protocols are: HTTP, HTTPS, FTP, SFTP, SCP, S3, S3SSL e ASPERA.'),
                            cols: 120,
                            required: true  }
                        ],
                        ["aps/CheckBox", {
                            id: "use_auth",
                            label: _("Requires autehtication"),
                            hint: _("Input URI requires user/password authentication"),
                            checked: useAuth } ],
                        ["aps/TextArea", {
                            id: "new_description",
                            label: _("Description"),
                            value: at(model, "description"),
                            cols: 120,
                            rows: 4}
                        ],
                        ["aps/Select", {
                            id: "new_fmt",
                            label: _( "Screen Format"),
                            value: at(model,"screen_format"),
                            store: screen_formats }
                        ]
                    ]],
                    ["aps/FieldSet", {title:  _("Avanced Options (additional charges may apply)")  }, [
                        ["aps/CheckBox", {
                            id: "new_https",
                            label: _("Use HTTPS?"),
                            hint: _("Just In Time Encryption of content"),
                            checked: at(model, "https") } ],
                        ["aps/CheckBox", {
                            id: "new_premium",
                            label: _("Premium Configuration Options?"),
                            hint: _("Premium configuration includes 3 HD outputs plus 2 SD outputs, and ofers 4 output protocols: HLS, HSS, HDS and DASH"),
                            checked: at(model, "premium")
                            }
                        ]
                    ]]
                ]];
            load(widgets).then(function(){
                /* Create handlers for the navigation buttons */
                aps.app.onCancel = function() {
                    aps.apsc.gotoView("jobs");
                };
                aps.app.onNext = function() {
                    var page = registry.byId("page");
                    page.get("messageList").removeAll();

                    /* Validate the values assigned to widgets */
                    if (!page.validate()) {
                        aps.apsc.cancelProcessing();
                        return;
                    }

                    /* Save the values in the client"s storage */
                    wd.put(getPlainValue(model));
                    /* and proceed to the next screen */
                    aps.apsc.gotoView("job-new-last");
                };
            });
        }
    );
    </script>
</head>
<body>
</body>
</html>
